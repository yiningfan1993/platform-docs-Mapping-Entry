**********************
Order List
**********************

Order list is a centralized space for users to create order, manage order, monitor order status and review deliverables. 

Order List is the default page after users opens the mapping order application, which can be found in the function list on the left-hand side of the platform interface.

 .. figure:: /images/OrderListInterface.png
    :align: center
    :alt: OrderListInterface

    *General Interface of Order List*

The following information is contained in the order list table:

    #. Order ID: unique identifier of the order;
    #. Order Name: name of the order;
    #. Order Status: current status of the order;
    #. Quote Value: quote value generated based on the size of AOI and selected catetitles;
    #. Expect Image Arrival: expect image arrival time provided by users;
    #. Expect Delivery Date: expect delivery date of the vector results.

Orders can be in the following status during the process. Users can plan the project accordingly based on the current status:


        * Order Created: order has been created and requires more information to generate a cost quotation;
        * Quotation: cost quotation has been generated by the system;
        * Order Placed: order settings have been confirmed and sent to production team;
        * Order In Progress: production team is working on the order;
        * Delivered - Ready for Review: vector result is ready to be delivered and reviewed;
        * Review in Progress: the vector result is being reviewed;
        * Pushback for Refining: review is finished for the vector results and comments are sent to production team for further refinement;
        * Refining in Progress: production team is refining the vector results based on the received comments.
    

Create Order
******************

Users can start a new order by clicking on the :guilabel:`Create Order` button located on the top-right of the interface. 

.. The following options will be available:

.. Service type:

..    * Modeling & Annotation: the order will apply modeling and Ecopia annotation as the service;
..    * Modeling: the order will apply modeling and users will annotate the vector result (if applicable) within their own organization.

Click on "Submit" after setting the order name and provide corresponding opportunity ID from Salesforce, the order list page will jump to basic settings page for users to provide more detailed information. The settings page can also be opened by clicking |ViewDetails| in the action column of each order.

 .. figure:: /images/CreateOrder.png
    :align: center
    :height: 240
    :alt: CreateOrder

    *Create Order*



Action: Settings |ViewDetails|
*************************************

Order settings section allow users to modify the input data (AOI and imagery), requirements for feature extraction, and delivery settings.

Users can view and edit details of the order by clicking on |ViewDetails| button in the action column. The order list page will jump to input data page once a new order is created for users to provide more information about the order.

 .. figure:: /images/OrderDetails.png
    :align: center
    :alt: OrderDetails

    *Order Details*

The following 4 tabs consist the order details:

    #. :ref:`OrderList:Input Data`
    #. :ref:`OrderList:Extraction Settings`
    #. :ref:`OrderList:Delivery Settings`
    #. :ref:`OrderList:Quote & Place Order`

Input Data
===============

This tab contains setting information for order's AOI and corresponding imagery data that will be used for production.

AOI Data
------------------

**1. Add AOI Data**

    By clicking :guilabel:`Add AOI` button on the top right corner, users can upload the AOI file from local machine or through S3 buckets. Once uploaded, the AOI will be listed under **AOI Data** section of the page.

    .. figure:: /images/AddAOILocalDrive.png
        :align: center
        :height: 300
        :alt: AddAOILocalDrive

        *Add AOI via Local Drive*

|

    .. figure:: /images/AddAOIS3.png
        :align: center
        :height: 300
        :alt: AddAOIS3

        *Add AOI via S3*

    .. note::
        The AOI file needs to be in zipped shapefile format and smaller than 4 MB.


**2. AOI Actions**


    The following actions are available for uploaded AOI files.

    #. Preview AOI |PreviewAOI|: By clicking |PreviewAOI| button, users can review the uploaded AOI file overlay with Google Maps.
    #. Remove AOI |DeleteAOI|: AOI will be removed once click on the |DeleteAOI| button.


Imagery Data
----------------------------

**1. Add Imagery**


    Order's imagery datasets are listed in this section. By clicking on the :guilabel:`Add Imagery` button in the **Imagery Data** section, users can add imagery data to the order by providing the following information:

        * **Imagery Type**:

            * **Single View**: single view imagery for 2D feature extraction
            * **Multi View**: multi-view imagery for 3D production

        * **Location**: 

            * **Local Drive**: upload by drag-and-drop or navigate to the location of the file on local machine
            * **Cloud Service**: S3 bucket that store the imagery data or through partnered imagery provider

                * **Own S3**: customers own S3 path with corresponding access key and secret access key
                * **Ecopia S3**: system generated Ecopia S3 bucket paired with access key and secret access key for users to upload imagery datasets to designated S3 buckets
                * **Imagery Provider**: download imagery through imagery provider by providing resolution (mandatory) and vintage (not mandatory).
        

        .. figure:: /images/AddStandardImagery.png
            :alt: AddStandardImagery
            :align: center

            *Add Standard Imagery*

    After the information is provided, click on :guilabel:`Submit`. The newly create imagery dataset will be listed in **Imagery Data** section. In the meantime, system will process the imagery automatically and run coverage check against the AOI. 

**2. Imagery Data Action**


    The following actions are available for uploaded imagery datasets:

        #. Edit Imagery |Edit|: users can edit imagery datasets by adjusting the location information;
        #. Delete Imagery |DeleteAOI|: users can remove the uploaded imagery dataset by clicking on this button.


Coverage Check
-----------------
If the provided imagery failed to cover the entire provided AOI, the following notification will appear at the bottom of the input data section. 

.. figure:: /images/CoverageCheck.png
    :alt: CoverageCheck
    :align: center

    *Coverage Check Notification*

The following actions are available to the users:

#. Users can click on **Coverage Check Report** to review the actual coverage and download shapefile for the missing coverage area by clicking on corresponding button in the pop-up window;

    .. figure:: /images/CoverageCheckReport.png
        :alt: CoverageCheckReport
        :align: center

        *Coverage Check Report*

#. After the users adjusted the content in the S3 path to provide more coverage, they can choose to :guilabel:`Validate Again` to see if the adjusted content fully covers the AOI;
#. Users can also choose to :guilabel:`Ignore Missing Area` if the missing area is not crucial to the project. 

Click on :guilabel:`Save & Continue` to save the input data settings and continue to extraction settings.

Extraction Settings
====================

This space allows users to select desired features (Catetitle) to be extracted from the provided imagery.

Users can select based on product packages or select catetitles individually. Advanced settings and other supporting documents can also be specified and uploaded for production team to better understand the extraction request.

 .. figure:: /images/ExtractionSettings.png
    :align: center
    :alt: ExtractionSettings
    

    *Extraction Settings*

Production Selection
---------------------------

**1. Select by Standard Packages**

    A list of standard product packages are listed on top of the catetitles. Users can select one or multiple packages. Corresponding catetitles will be automatically selected and shown below.

    .. figure:: /images/ProductPackage.png
        :align: center
        :alt: ProductPackage
        

        *Product Package*


    

    |
    Users can also select individual catetitles and make the current selection as template for future use. After selecting the catetitles that need to be included in the package, click on :guilabel:`Add Package Template`, the current selection and corresponding settings will be saved as a template and appears in the list of standard packages.

    .. figure:: /images/AddTemplate.gif
        :align: center
        :alt: AddTemplate
        

        *Add Package Template*


**2. Select by Individual Catetitles**

    

    Catetitles are categorized into 4 different Categories:

        * **Raster**: include DSM and orthomosaic data generated through production pipeline
        * **2D Landcover**: includes building, road, manmade and natural landcover features; height attribute can be selected to construct 3D landcover data
        * **Advanced Transportation**: includes different types of transportation related centerlines, polygons, points and other transportation features that can be used for guiding and navigation
        * **Non-Standard**: features that are not derived through modeling. These features have been categorized into centerlines, road lines, polygons, and signs.
                
            
    
    Users can add catetitles to the extraction orders by clicking on the check boxes next to them.

    Users can select the category in general or select second-tier categories to further differentiate the features.

        .. figure:: /images/SecondTier.png
            :alt: Second-Tier Categories
            :align: center

            *Example of Second-Tier Category*



    Under Non-standard tab, users can also define new categories by clicking on :guilabel:`+ Add Category` button. In the pop-up window, category name, geometry type, definition, image example, and annotate rules are required to create this new category.

    .. note:: 
        Please refer to product specifications for more detailed explanation of the catetitles.


**3. Advanced Settings For Selected Products**


    In the **Advanced settings for selected products** section, users can modify the capturing rules for catetitles and dictate catetitle name in the delivery shapefile.


    .. figure:: /images/OpenAdvancedSettings.gif
        :alt: OpenAdvancedSettings
        :align: center

        *Advanced Settings for Selected Catetitles*

        
    * **Change Catetitle Name**: Catetitle name in the delivery shapefile can be modified by clicking on the |Edit| button, click on :guilabel:`Save` to save the changes;
    * **Special Capturing Rules**: Special capturing rules can be added through |advancesettings| to provide production team with clear instructions, click on :guilabel:`Update` to save provided information. The following information needs to be provided.

            * Category: name of the corresponding catetitle;
            * Geometry type: type of the geometry of the corresponding catetitle;
            * Definition: project definition of the catetitle if it is different from the standard Ecopia specifications;
            * File Upload: imagery example of the provided definition or annotate rule, which can assist production team to better understand the extraction requirements;
            * Annotate Rules: methods of drawing and capturing if different from Ecopia standard specifications.

            |
            .. figure:: /images/catetitleAdvancedSettings.png
                :alt: Catetitle Advanced Settings
                :align: center

                *Catetitle Advanced Settings*

            
            |
    * **Overlapping Rules**: Users can also dictate whether overlapping is allowed. Users can also adjust the order of overlapping by re-arranging the order of catetitles.

            |
            .. figure:: /images/AdjustPriority.gif
                :alt: AdjustPriorty
                :align: center

                *Adjust Overlapping Priority*            



Documents for Extraction Request
----------------------------------

To help production team better understand the extraction requirements, users can also attach supporting document in the **Attached Document for Extraction Request** section.

 .. figure:: /images/Documents.png
    :align: center
    :alt: Documents
    

    *Documents for Extraction Request*


Click on :guilabel:`Save & Continue` to apply the changes and continue to **Delivery Settings**.



Delivery Settings
====================

Users can define how the data should be delivered by providing the following information in the delivery settings section:

#. **Delivery Projection**: projection system that should be applied to the vector result. The following options are available:

    * WGS84
    * WGS84/UTM
    * OTHER
    * Users provided EPSG code in the blank space and added as an option

#. **Delivery Format**: data format that the vector result will be delivered in
#. **Deliver Grid Size**: grid can be applied to the vector result to split larger polygon into smaller pieces. 

Click on "Save & Continue" to apply all changes and move to **Order Payment** section.

Quote & Place Order
=====================

Once the AOI information and extraction settings are provided through previous pages, the system can generate quote and estimated production time for this order after users provide **Expect Image Arrival** information. Users can review the cost quotation and delivery time information and place order.

Quote
----------------------------
User can obtain quote information by clicking on the :guilabel:`Quote` button. At this stage, the system is calculating the quote for the order based on the extraction settings and size of the AOI. The process will normally take a few minutes to complete.

.. figure:: /images/CalculatingQuote.png
    :alt: Calculating Quote
    :align: center

    *Quote is being Calculated*

The following information will be provided:

    #. **Cost Quotation(USD)**: quotation for this prodction order in USD, does not include cost for non-standard features;
    #. **Delivery Days**: number of days required for production team to deliver the result;
    #. **Area**: size of the AOI in KM2;
    #. **Building**: estimated number of buildings in the AOI;
    #. **Quotation Expired Time**: the expiration time of the current quote
    #. **Order Place Status**: current status of the order

        * Not Applied: the order has not been placed by the current users.
        * Order has been placed at ... : order has been placed at certain time stamp and system has sent notification to the production admin.

Place Order
----------------------------
Once the quote is calculated, users can place order by clicking on the :guilabel:`Place Order`. After the order is placed, the production team will receive notification and the production process will be triggered.

.. figure:: /images/PlaceOrder.png
    :alt: PayNow
    :align: center

    *Order is ready to be placed*


Action: Delete Order |DeleteAOI|
*********************************
Users can delete an order by clicking on the |DeleteAOI| button in the action column.


Action: Delivery |Delivery|
*********************************
Email notification will be sent to order owner once the vector result is delivered. By clicking on the |Delivery| button, users can view the deliveries and their path on the platform. 


.. figure:: /images/DeliveryResult.png
    :alt: DeliveryResult
    :align: center

    *Delivery Result Window*

The following information is included:

#. **Delivery Method**: pre-defined delivery method
#. **Platform Link**: users can navigate to the file's platform location by clicking on the link. Users can also choose to click on the |downloadresult| button to download the file to local machine
#. **Raster WMTS URL**: URL to raster dataset in WMTS format
#. **Raster WMTS Expiration**: date and time that the raster WMTS will be expired
#. **Vector WMTS URL**: URL to vector results in WMTS format

.. note::
      If a new vector result has been delivered, the delivery result window will display the corresponding information for the latest result.




.. Action: Review |Review|
.. *********************************
.. By clicking on the |Review| button, the QC review project for the current delivery result will be opened in different page in QC tools. Users can perform regular QC review workflow then submit comment for production team to fix the comment accordingly.


Action: Feedback |Feedback|
*********************************

Customer Feedback
--------------------------------
Under this tab, users can upload their offline comment in zipped shapefile format for production team to review and fix accordingly. Along with the zipped shapefile that contains comments, users can also provide writing description and imagery example for production team to better understand the issues.

.. figure:: /images/OfflineComments.png
    :alt: OfflineComments
    :align: center

    *Upload Offline Comments*

Production Rating
---------------------------------
Users can also rate the performance of the engineers and production team members that are involved in the production of this order.


.. figure:: /images/ProductionRatingEngineer.png
    :alt: ProductionRatingEngineer
    :align: center

    *Production Rating - Engineer*


.. figure:: /images/ProductionRatingProduction.png
    :alt: ProductionRatingProduction
    :align: center

    *Production Rating - Production Team*

.. |CreateOrder| image:: /images/CreateOrder.png
    :height: 21

.. |ViewDetails| image:: /images/ViewDetails.png
    :height: 30

.. |binddataset| image:: /images/binddataset.png
    :height: 21

.. |checkcoverage| image:: /images/checkcoverage.png
    :height: 21

.. |ViewCoverageReport| image:: /images/ViewCoverageReport.png
      :height: 25

.. |ManualConfirm| image:: /images/ManualConfirm.png
      :height: 20

.. |Passed| image:: /images/GreenCheck.png
      :height: 20

.. |PreviewAOI| image:: /images/PreviewAOI.png
      :height: 25

.. |DeleteAOI| image:: /images/DeleteAOI.png
      :height: 32

.. |Delivery| image:: /images/Delivery.png
      :height: 30

.. |Edit| image:: /images/Edit.png
      :height: 30

.. |Feedback| image:: /images/Feedback.png
      :height: 30

.. |Review| image:: /images/Review.png
      :height: 30

.. |advancesettings| image:: /images/AdvanceSettings.png
      :height: 30

.. |downloadresult| image:: /images/downloadresult.png
      :height: 30